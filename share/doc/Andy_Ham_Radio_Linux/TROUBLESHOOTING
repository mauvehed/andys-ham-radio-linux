
TROUBLESHOOTING
===============

When using Linux with ham radios, one often encounters some common issues.
This document will attempt to explain how to debug these issues with the
goal of getting your rig to work with wsjt-x.  If your rig works with that 
program, it'll quite likely work with many others.

Note that this discussion is constrained to rigs that use USB interfaces.
Older rigs use other interfaces, and they will not be addressed here.
Note also that I only have experience with IC-7300 and IC-7610 (both of which
are very similar in this regard).

I'm looking for input from the user community.  Anything that helps to improve
this document will be GREATLY appreciated!  I especially would like information
on how to get other rigs working with Linux and AHRL.  I apologize that my 
examples are constrained by my experience only with ICOM rigs.

When the instructions say "type this command", that means one should bring
up a terminal window, into which the commands will be typed.

0) First things first:  remove the brltty package from your system.  It often
   causes problems.

   Type this command:  sudo apt purge brltty

   Note that as of AHRL V26e, this will be done automatically.  Still, it does
   not hurt to issue the command.


0.5) On Linux Mint 22, I had success by doing the following.  I don't know if it
     is strictly necessary.

     Type these commands:  sudo apt purge pipewire
                           sudo apt install pulseaudio


1) Does Linux see your rig?

   a) make sure the rig is NOT connected to the computer
   b) type this command: lsusb
      (note the output)
   c) plug the USB cable into the rig and computer
   d) again type this command: lsusb
   e) compare the output to the previous output
   f) one should notice a difference if the rig is recognized by the kernel

   For example, with my IC-7610, I see the following differences:

   Bus 001 Device 005: ID 10c4:ea60 Silicon Labs CP210x UART Bridge
   Bus 001 Device 006: ID 10c4:ea60 Silicon Labs CP210x UART Bridge

   In this very specific example, it was required that I load the cp210x module
   into the kernel in order to get the result shown above.


2) USB connected rigs should show a "comm port" at /dev/ttyUSB*

   Type this command:  ls -al /dev/ttyUSB*
   
   If the message "No such file or directory" is seen, that's a problem.
   You may need a new or updated file:  /usr/lib/udev/rules.d/60-serial.rules
   This file may need to be specific for your rig.

   For the IC-7610, I see /dev/ttyUSB0 and /dev/ttyUSB1, as shown below:

   ls -al /dev/ttyUSB*
   crw-rw----+ 1 root dialout 188, 0 Jun  7 15:00 /dev/ttyUSB0
   crw-rw----+ 1 root dialout 188, 1 Jun  7 14:47 /dev/ttyUSB1

   For the IC-7610, the file (below) works for me.  If you decide to change
   or update the file, be VERY CERTAIN to save the old file, just in case.
   Note that one will have to be the root user to make these changes.

   === start 60-serial.rules ===

# do not edit this file, it will be overwritten on update

ACTION=="remove", GOTO="serial_end"
SUBSYSTEM!="tty", GOTO="serial_end"

SUBSYSTEMS=="usb", IMPORT{builtin}="usb_id", IMPORT{builtin}="hwdb --subsystem=usb"
SUBSYSTEMS=="pci", ENV{ID_BUS}=="", ENV{ID_BUS}="pci", \
  ENV{ID_VENDOR_ID}="$attr{vendor}", ENV{ID_MODEL_ID}="$attr{device}", \
  IMPORT{builtin}="hwdb --subsystem=pci"

# /dev/serial/by-path/, /dev/serial/by-id/ for USB devices
KERNEL!="ttyUSB[0-9]*|ttyACM[0-9]*", GOTO="serial_end"

SUBSYSTEMS=="usb-serial", ENV{.ID_PORT}="$attr{port_number}"

IMPORT{builtin}="path_id"
ENV{ID_PATH}=="?*",                   ENV{.ID_PORT}=="",   SYMLINK+="serial/by-path/$env{ID_PATH}"
ENV{ID_PATH_WITH_USB_REVISION}=="?*", ENV{.ID_PORT}=="",   SYMLINK+="serial/by-path/$env{ID_PATH_WITH_USB_REVISION}"
ENV{ID_PATH}=="?*",                   ENV{.ID_PORT}=="?*", SYMLINK+="serial/by-path/$env{ID_PATH}-port$env{.ID_PORT}"
ENV{ID_PATH_WITH_USB_REVISION}=="?*", ENV{.ID_PORT}=="?*", SYMLINK+="serial/by-path/$env{ID_PATH_WITH_USB_REVISION}-port$env{.ID_PORT}"

ENV{ID_BUS}=="", GOTO="serial_end"
ENV{ID_SERIAL}=="", GOTO="serial_end"
ENV{ID_USB_INTERFACE_NUM}=="", GOTO="serial_end"
ENV{.ID_PORT}=="", SYMLINK+="serial/by-id/$env{ID_BUS}-$env{ID_SERIAL}-if$env{ID_USB_INTERFACE_NUM}"
ENV{.ID_PORT}=="?*", SYMLINK+="serial/by-id/$env{ID_BUS}-$env{ID_SERIAL}-if$env{ID_USB_INTERFACE_NUM}-port$env{.ID_PORT}"

LABEL="serial_end"

   === end 60-serial.rules ===


3) Ensure that the ham radio user is a member of the dialout group.

   This will be setup for the default user when AHRL is installed correctly.

   Type this command:  groups

   Your output will be slightly different but should look similar to this:   

   andy adm dialout cdrom sudo dip plugdev users netdev lpadmin svxlink xastir-ax25
 
   
4) Type this command:  ls -al /dev/serial/by-id

   One should see symlinks from a file with a very long name to /dev/ttyUSB0 and 
   /dev/ttyUSB1.  For the IC-7610, this is what I see:

   ls -al /dev/serial/by-id
   total 0
   drwxr-xr-x 2 root root 80 Jun  7 14:47 .
   drwxr-xr-x 4 root root 80 Jun  7 14:47 ..
   lrwxrwxrwx 1 root root 13 Jun  7 14:47 usb-Silicon_Labs_CP2102_USB_to_UART_Bridge_Controller_IC-7610_12005203_A-if00-port0 -> ../../ttyUSB0
   lrwxrwxrwx 1 root root 13 Jun  7 14:47 usb-Silicon_Labs_CP2102_USB_to_UART_Bridge_Controller_IC-7610_12005203_B-if00-port0 -> ../../ttyUSB1

   My recommendation is to use the very long names in /dev/serial/by-id when
   referencing your rig in programs such as wsjt-x.  In this way, if other 
   USB devices are connected, the program will still properly communicate
   with the rig.  If one hardcodes /dev/ttyUSB0 (for example) into wsjt-x,
   and if that gets mapped to a different device on a different day, your
   ham radio stuff won't work as expected, and that's quite frustrating.


5) Is audio working properly?

   Bring up the sound settings GUI (or audio mixer).  That is usually
   accomplished by clicking on the sound/volume icon somewhere on the desktop.
   This varies depending on the flavor of Linux and/or your desktop software.

   Click the tab showing outputs.  If it says "Dummy Output", that's a problem.

   Type this command to attempt to fix it:  /usr/local/bin/fix_sound

   One should then see something reasonable for output (speakers, the rig
   sound card, etc).  For the IC-7610, I see "PCM2901 Audio Codec".

   Note that this solution won't work unless your flavor of Linux is
   using the ALSA sound system.

   If that doesn't fix it, an internet search will be needed.  You'll need to
   know your exact sound hardware and the specific version of Linux in order
   to solve it.


6) If and only if all of the above has been tested and shown to be OK:

   Use the menu to bring up wsjt-x.

   Click the File -> Settings -> General tab and enter your callsign and grid.

   Click on the File -> Settings -> Audio tab and setup the following:

   a) Click the dropdown menu for Input and make an appropriate selection.
      For my IC-7610, a working selection is:
        alsa_input.usb-Burr-Brown_from_TI_USB_Audio_CODEDC-00.analog-stereo

   b) Click on the dropdown menu for Output and make an appropriate selection.
      For my IC-7610, a working selection is:
        alsa_output.usb-Burr-Brown_from_TI_USB_Audio_CODEDC-00.analog-stereo

   Click on the File -> Settings -> Radio tab and do the following:

   c) Click the dropdown menu to select the rig.
   d) Cut/paste the long file name /dev/serial/by-id/<long name> into the "Serial Port" box.
   e) Other settings will vary based on the rig.
   f) Once you've made choices for the other settings, click the "Test CAT" button.
   g) If the "Test CAT" button turns GREEN, your settings are reasonable.
   h) However, if it turns RED, revisit the settings and adjust them.
   i) Set your rig's output power to zero
   j) Click "Test PTT" and see if the rig goes into transmit mode.
   k) Click "Test PTT" again to get out of transmit mode.
   l) If the rig does NOT go into transmit mode, adjust the settings accordingly.

   Exit the File -> Settings menu and go back to the main wsjt-x GUI.

   On the left of the screen, just underneath "CQ only", click on the dropdown
   menu for the band and select a desired band (for this example, try 20m).

   The frequency should be 14.074 MHz if the software is in FT8 mode.

   Note that the rig should have changed to this frequency.  Test other modes
   to see that rig control is properly changing the rig to the desired frequency.

   Watch the timer in the lower right of the wsjt-x GUI.  Every 15 seconds, one
   should see the "Band Activity" window scrolling as FT8 messages are decoded.

   If you see messages being decoded, congratulations!!!

AMS 09-June-2025
